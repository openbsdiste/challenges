(function(b){b.widget("app.tabs",b.ui.tabs,{options:{scrollable:true,mousewheel:false,closable:false,nonClosableIndexes:[],duration:200,easing:"swing",selectOnScroll:false,scrollDistance:300,arrowsPosition:"wrap"},_create:function(){if(this._super){this._super()}else{b.ui.tabs.prototype._create.apply(this,arguments)}this.activeTabClass=(this.version>"1.9.0")?".ui-tabs-active":".ui-tabs-selected";this.tablistName=this.tablist?"tablist":"list";this.tabsName=this.tabs?"tabs":"lis"},_setOptions:function(a){if(this._super){this._super(a)}else{b.ui.tabs.prototype._setOptions.apply(this,arguments)}this._process()},_refresh:function(){this._super();this._process()},_tabify:function(a){b.ui.tabs.prototype._tabify.apply(this,arguments);this._process()},_process:function(){this[(this.options.closable?"_closify":"_unclosify")]();this[(this.options.scrollable?"_scrollify":"_unscrollify")]();this[(this.options.mousewheel?"_wheelify":"_unwheelify")]()},_wheelify:function(){this.tablist.unbind("mousewheel.tabs");this.tablist.bind("mousewheel.tabs",b.proxy(this._onMousewheeled,this));this.wheelified=true},_scrollify:function(){this._unscrollify();this.tablist.data("padding-left",this.tablist.css("padding-left"));this.tablist.css({width:"10000px","padding-left":"0"});var i=0,k=0,j={},h={};switch(this.options.arrowsPosition){case"wrap":default:i=24;k=24;j={left:3};h={left:24};j={left:3};h={right:3};break;case"left":i=48;k=0;j={left:3};h={left:24};break;case"right":i=0;k=48;j={right:24};h={right:3};break}this.tablist.wrap(b("<div/>").addClass(this.widgetBaseClass+"-container").css({"margin-left":i+"px","margin-right":k+"px",overflow:"hidden",position:"relative"}));this.container=b("."+this.widgetBaseClass+"-container",this.element);var l=(parseInt(parseInt(this.tablist.innerHeight()/2)-8)),a={cursor:"pointer","z-index":1000,position:"absolute",height:this.tablist.outerHeight()-(b.browser.safari?2:1)};this.nav=b("<div/>").disableSelection().addClass(this.widgetBaseClass+"-navigation").css({position:"relative","z-index":3000,display:"none"}).append(b("<span/>").disableSelection().attr("title",Global.tr("tabs_previous")).css(a).addClass("ui-state-active ui-corner-tl ui-corner-bl").addClass(this.widgetBaseClass+"-prev").css(j).append(b("<span/>").disableSelection().addClass("ui-icon ui-icon-carat-1-w").html(Global.tr("tabs_previous")).css("margin-top",l)).click(b.proxy(this._previousButtonClicked,this)),b("<span/>").disableSelection().attr("title",Global.tr("tabs_next")).css(a).addClass("ui-state-active ui-corner-tr ui-corner-br").addClass(this.widgetBaseClass+"-next").css(h).append(b("<span/>").addClass("ui-icon ui-icon-carat-1-e").html(Global.tr("tabs_next")).css("margin-top",l)).click(b.proxy(this._nextButtonClicked,this)));this.element.prepend(this.nav);this._enableNavigationButtons();this.element.bind(this.widgetEventPrefix+"select.tabs",b.proxy(function(d,c){this._scrollToTab(this.tabs.eq(c.index))},this));this.element.bind(this.widgetEventPrefix+"add.tabs",b.proxy(function(){this._enableNavigationButtons()},this));b(window).bind("resize.tabs",b.proxy(function(){setTimeout(b.proxy(function(){this._enableNavigationButtons()},this),this.options.duration)},this));this.scrollified=true},_updateNavigationButtons:function(){setTimeout(b.proxy(function(){var k=false,a=false;var n=this.nav.find("."+this.widgetBaseClass+"-next");var p=this.nav.find("."+this.widgetBaseClass+"-prev");if(this.options.selectOnScroll){k=this.tablist.find("li"+this.activeTabClass).is(":last-child");a=this.tablist.find("li"+this.activeTabClass).is(":first-child")}else{var l=parseFloat(this.tablist.css("margin-left"));a=(l==0);var m=this.container.width();var o=this.tabs.last();var j=o.position().left+o.width();k=(j<m)}if(k){p.removeClass("ui-state-disabled");n.addClass("ui-state-disabled")}else{if(a){n.removeClass("ui-state-disabled");p.addClass("ui-state-disabled")}else{n.removeClass("ui-state-disabled");p.removeClass("ui-state-disabled")}}},this),this.options.duration)},_enableNavigationButtons:function(){if(this._needScroll()){this.nav.show()}else{this.nav.hide();this._showAllTabs()}this._updateNavigationButtons()},_showAllTabs:function(){this._scrollToTab(this.tablist.find("li:first"));this._scrollToTab(this.tablist.find("li:last"))},_closify:function(){this._unclosify();this.tabs.each(b.proxy(function(f,a){if(b.inArray(f,this.options.nonClosableIndexes)!==-1){b(".ui-tabs-close",a).remove();return}if(b(a).find(".ui-tabs-close").length>0){return}var e=parseInt(parseInt(this.tabs.find(":first").innerHeight()/2,10)-12);b(a).disableSelection().append(b("<span>").css({"float":"left",cursor:"pointer",margin:"6px 4px 0 0px"}).addClass("ui-tabs-close ui-icon ui-icon-circle-close").attr("title","Fermer").click(b.proxy(this._closeButtonClicked,this)))},this));this.closified=true},_closeButtonClicked:function(e){var a=b(e.currentTarget).parent();var f=this.tabs.index(a);this.remove(f);this._trigger("close",null,{index:f,li:a});this._enableNavigationButtons();return false},_previousButtonClicked:function(a){if(b(a.currentTarget).hasClass("ui-state-disabled")){return}this._goToPreviousTab()},_nextButtonClicked:function(a){if(b(a.currentTarget).hasClass("ui-state-disabled")){return}this._goToNextTab()},_getPreviousTabIndex:function(){var a=this.tablist.find("li"+this.activeTabClass).prevAll().length-1;if(a<0){a=0}return a},_getNextTabIndex:function(){var a=this.tablist.find("li"+this.activeTabClass).prevAll().length+1;if(a>=this.tabs.length){a=this.tabs.length-1}return a},_goToPreviousTab:function(){var a=this._getPreviousTabIndex();this[(this.options.selectOnScroll?"_selectTab":"_scrollTo")]((this.options.selectOnScroll?a:false))},_goToNextTab:function(){var a=this._getNextTabIndex();this[(this.options.selectOnScroll?"_selectTab":"_scrollTo")]((this.options.selectOnScroll?a:true))},_selectTab:function(a){this.tabs.eq(a).find("a").trigger("click")},_scrollTo:function(j){if(!this.animated){this.animated=true;var g=parseFloat(this.tablist.css("margin-left"));if(j){delta=g-this.options.scrollDistance;var h=this.container.width();var a=this.tabs.last();var i=a.position().left+a.width()-this.options.scrollDistance;if(i<h){delta+=h-i-6}}else{delta=g+this.options.scrollDistance;if(delta>0){delta=0}}this.tablist.animate({"margin-left":delta},this.options.duration,this.options.easing,b.proxy(function(){this.animated=false},this));this._updateNavigationButtons()}},_scrollToTab:function(m){m=(typeof m!=="undefined")?m:this.tabs.find(this.activeTabClass);var j=this.container.width();var n=m.position()?m.position().left:0;var a=n+m.width();var k=parseFloat(this.tablist.css("margin-left"));if(a>j){var i=-(a-j)+k-6;this.tablist.animate({"margin-left":i},this.options.duration,this.options.easing)}if(n<0){var l=-n+k;this.tablist.animate({"margin-left":l},this.options.duration,this.options.easing)}this._updateNavigationButtons()},_onMousewheeled:function(a,d){if(this._needScroll()){this[((d>0)?"_goToPreviousTab":"_goToNextTab")]()}return false},_needScroll:function(){var a=0;this.tabs.each(function(){a+=b(this).outerWidth()});var d=60;return(a>this.container.width()-d)},_destroy:function(){this._unclosify();this._unscrollify();this._unwheelify();if(this._super){this._super()}},_unscrollify:function(){if(this.scrollified){this.tablist.css({width:"auto","padding-left":this.tablist.data("padding-left")});if(this.nav){this.nav.remove()}this.tablist.unwrap();this.element.unbind(".tabs");b(window).unbind("resize.tabs");this.scrollified=false}},_unwheelify:function(){if(this.wheelified){this.tablist.unbind("mousewheel.tabs");this.wheelified=false}},_unclosify:function(){if(this.closified){b(".ui-tabs-close",this.element).remove();this.closified=false}}});if(b.ui.version<"1.9.0"){b.widget("app.tabs",b.app.tabs,{destroy:function(){this._destroy();b.ui.tabs.prototype.destroy.apply(this,arguments)}})}if(b.ui.version>="1.9.0"){b.widget("app.tabs",b.app.tabs,{_create:function(){var a=this;this.element.unbind("tabsbeforeload.tabs");this.element.bind("tabsbeforeload.tabs",function(f,e){if(b.data(e.tab[0],"cache.tabs")){f.preventDefault();return}b.extend(e.ajaxSettings,a.options.ajaxOptions,{error:function(c,i,d){try{a.options.ajaxOptions.error(c,i,e.tab.closest("li").index(),e.tab[0])}catch(d){}}});e.jqXHR.success(function(){if(a.options.cache){b.data(e.tab[0],"cache.tabs",true)}})});this._super()}})}})(jQuery);